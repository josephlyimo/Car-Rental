<h2>Book a Car</h2>

<form id="bookingForm">
  {{#if car}}
    <p>Car Name: {{car.name}}</p>
    <p>Car Color: {{car.color}}</p>
    <p>Car Type: {{car.type}}</p>
    <input type="hidden" id="car_id" name="car_id" value="{{car.id}}" />
    <p>Purpose: {{car.type}}</p>
    <input type="hidden" id="purpose" name="purpose" value="{{car.type}}" />
  {{else}}
    {{#with cars.[0]}}
      <p>Car Name: {{name}}</p>
      <p>Car Color: {{color}}</p>
      <p>Car Type: {{type}}</p>
      <input type="hidden" id="car_id" name="car_id" value="{{id}}" />
      <p>Purpose: {{type}}</p>
      <input type="hidden" id="purpose" name="purpose" value="{{type}}" />
    {{/with}}
  {{/if}}

  {{#unless car}}
  {{!-- This block is now redundant because the else block above handles the no car case --}}
  {{/unless}}

  <label for="start_date">Start Date:</label>
  <input type="date" id="start_date" name="start_date" required>

  <label for="end_date">End Date:</label>
  <input type="date" id="end_date" name="end_date" required>

  <button type="submit">Book Now</button>
</form>

<script>
  const bookingForm = document.getElementById('bookingForm');
  bookingForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(bookingForm);
    const data = {
      car_id: formData.get('car_id'),
      purpose: formData.get('purpose'),
      start_date: formData.get('start_date'),
      end_date: formData.get('end_date')
    };

    try {
      const response = await fetch('/bookings', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (response.ok) {
        alert('Booking created successfully!');
        window.location.href = '/bookings/history';
      } else {
        const resData = await response.json();
        alert('Error: ' + resData.message);
      }
    } catch (err) {
      alert('Error: ' + err.message);
    }
  });
</script>
